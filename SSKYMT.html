<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ส.สามสี • SSKratom-YMT</title>
    <meta name="description" content="เครื่องมือแบ่งขวดกระท่อมแม่นยำที่สุด by ส.สามสี">
    <meta name="theme-color" content="#1e6b3a">
    
    <!-- PWA -->
    <link rel="manifest" href="data:application/manifest+json,eyJuYW1lIjoiUy5zYW1zaSBCb3R0bGUgQ2FsY3VsYXRvciIsInNob3J0X25hbWUiOiJTLiDzYW1zaSIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMGYxNzJhIiwidGhlbWVfY29sb3IiOiIjMWU2YjNhIiwiaWNvbnMiOlt7InNyYyI6Imh0dHBzOi8vaW1nMi5waW5pbWcuY29tL3RyYW5zcGFyZW50LzUxMi8yMDYvMTg5L3Nza3JhdG9teW10LWxvZ28ucG5nIiwic2l6ZXMiOiI1MTJ4NTEyIiwidHlwZSI6ImltYWdlL3BuZyJ9XX0=">
    <link rel="icon" href="https://img2.pinimg.com/transparent/512/206/189/sskratomymt-logo.png" sizes="512x512">
    <link rel="apple-touch-icon" href="https://img2.pinimg.com/transparent/512/206/189/sskratomymt-logo.png">

    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">

    <style>
        :root { --p: #4361ee; --g: #27ae60; --gd: #1e6b3a; --s: #10b981; --w: #f59e0b; }
        * { margin:0; padding:0; box-sizing:border-box; }
        body { font-family:'Kanit',sans-serif; background:linear-gradient(135deg,#0f172a,#1e293b); color:#e2e8f0; min-height:100vh; transition:all .4s; }
        body.light { background:linear-gradient(135deg,#e0e7ff,#c3dafe); color:#1e293b; }
        body.light .calc { background:rgba(255,255,255,.96); border:1px solid #e0e7ff; }
        body.light input, body.light select { background:#f8fafc; color:#1e293b; border-color:#cbd5e1; }

        .container { max-width:900px: auto; margin:15px;  padding:5px; }
        .calc { background:rgba(30,41,59,.95); border-radius:10px; padding:5px; box-shadow:0 20px 50px rgba(0,0,0,.7); backdrop-filter:blur(12px); border:1px solid rgba(51,65,85,.5); }
        .logo img { width:110px; height:110px; border-radius:50%; border:5px solid #fbbf24; box-shadow:0 10px 30px rgba(251,191,36,.5); }
        .header h2 { font-size:2.3rem; text-align:center; background:linear-gradient(to right,#fbbf24,#f59e0b); -webkit-background-clip:text; -webkit-text-fill-color:transparent; font-weight:800; }
        .header p { text-align:center; color:#94a3b8; margin-top:0px; }

        .tabs { display:flex; flex-wrap:wrap; gap:10px; margin:10px 0; background:rgba(15,23,42,.6); padding:5px; border-radius:15px; }
        .tab { flex:1; padding:5px; text-align:center; background:transparent; border:none; color:#94a3b8; border-radius:10px; cursor:pointer; font-weight:600; min-width:100px; }
        .tab.active { background:linear-gradient(135deg,var(--p),#9b59b6); color:white; transform:translateY(-4px); box-shadow:0 10px 25px rgba(67,97,238,.5); }

        .tab-content { display:none; animation:fadeIn .5s; }
        .tab-content.active { display:block; }
        @keyframes fadeIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:none;} }

        input, select, button { width:100%; padding:10px; margin:10px 0; border-radius:15px; border:1px solid #334155; background:#0f172a; color:#e2e8f0; font-size:1rem; }
        input:focus, select:focus { outline:none; border-color:var(--p); box-shadow:0 0 0 4px rgba(67,97,238,.2); }
        button { background:linear-gradient(135deg,var(--p),#9b59b6); color:white; border:none; cursor:pointer; font-weight:600; }
        button:hover { transform:translateY(-3px); }

        .kratom { background:linear-gradient(135deg,#1a2e05,#163a00); border-radius:25px; padding:5px; margin:5px 5px 0px; position:relative; color:white; }
        .settings-btn { position:absolute; top:10px; right:10px; background:rgba(255,255,255,.2); width:50px; height:50px; border-radius:50%; border:none; color:white; font-size:0.6rem; cursor:pointer; }
        .settings { display:none; margin-top:10px; padding:10px; background:rgba(0,0,0,.5); border-radius:12px; }
        .settings.show { display:block; animation:fadeIn .4s; }

        .toggle { display:flex; align-items:center; justify-content:space-between; background:rgba(255,255,255,.1); padding:10px; border-radius:10px; margin:10px 0; }
        .switch { position:relative; display:inline-block; width:56px; height:30px; }
        .switch input { opacity:0; width:0; height:0; }
        .slider { position:absolute; cursor:pointer; top:0; left:0; right:0; bottom:0; background:#666; transition:.4s; border-radius:34px; }
        .slider:before { position:absolute; content:""; height:22px; width:22px; left:4px; bottom:4px; background:white; transition:.4s; border-radius:50%; }
        input:checked + .slider { background:var(--g); }
        input:checked + .slider:before { transform:translateX(26px); }

        .install { position:fixed; bottom:20px; left:50%; transform:translateX(-50%); background:var(--s); padding:16px 32px; border-radius:50px; border:none; color:white; font-size:1.2rem; font-weight:600; box-shadow:0 10px 30px rgba(16,185,129,.5); z-index:999; display:none; animation:bounce 2s infinite; }
        @keyframes bounce { 0%,100%{transform:translateX(-50%) translateY(0)} 50%{transform:translateX(-50%) translateY(-10px)} }

        .big { font-size:1.5rem; font-weight:600; color:#66bb6a; }
        .card { background:rgba(0,0,0,.4); padding:0px; border-radius:12px; text-align:center; margin:5px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="calc">
        <div style="text-align:center; margin-bottom:5px;">
            <img src="https://img2.pinimg.com/transparent/512/206/189/sskratomymt-logo.png" alt="Logo">
        </div>
        <div class="header">
            <h2>• ส.สามสี • SSKratomYMT</h2>
            <p>เครื่องมือแบ่งขวดกระท่อมแม่นยำที่สุดในไทย</p>
        </div>

        <div class="tabs">
            <button class="tab" data-tab="water-calculator">แปลงปริมาตรน้ำ</button>
            <button class="tab" data-tab="calc">เครื่องคิดเลข</button>
            <button class="tab" data-tab="volume">รวมปริมาตร</button>
            <button class="tab active" data-tab="kratom">แบ่งขวดกระท่อม</button>
        </div>

                <!-- แปลงปริมาตรน้ำ -->
        <div class="tab-content" id="water-calculator">
            <div style="background:rgba(67,97,238,0.15); padding:5px; border-radius:12px; margin-bottom:10px; border-left:15px solid var(--primary);">
                <p>น้ำ 1,000 มล. = 40 บาท • กรอกเพียงช่องใดช่องหนึ่ง</p>
            </div>
            <input type="number" id="bottles1000" placeholder="จำนวนขวด 1,000 มล.">
            <input type="number" id="bottles800" placeholder="จำนวนขวด 800 มล.">
            <div style="display:flex; gap:5px;">
                <button onclick="calculateWater()">คำนวณ</button>
                <button style="background:#64748b;" onclick="document.getElementById('bottles1000').value='';document.getElementById('bottles800').value='';document.getElementById('waterResult').style.display='none';">ล้าง</button>
            </div>
            <div id="waterResult" style="display:none; margin-top:5px;" class="result-card">
                <h3 style="color:#66bb6a;">ผลการคำนวณ</h3>
                <div id="waterText" style="font-size:1.18rem; color:#66bb6a; margin:5px 0;"></div>
                <div id="waterDetails"></div>
            </div>
        </div>

        <!-- เครื่องคิดเลข -->
        <div class="tab-content" id="calc">
            <div style="background:#0f172a; padding:10px; border-radius:14px; text-align:right; margin-bottom:10px;">
                <div id="display" style="font-size:1.1rem; color:#e2e8f0;">0</div>
            </div>
            <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:10px;">
                <button onclick="clr()">C</button><button onclick="del()">Del</button><button onclick="op('%')">%</button><button onclick="op('/')">/</button>
                <button onclick="op('7')">7</button><button onclick="op('8')">8</button><button onclick="op('9')">9</button><button onclick="op('*')">×</button>
                <button onclick="op('4')">4</button><button onclick="op('5')">5</button><button onclick="op('6')">6</button><button onclick="op('-')">-</button>
                <button onclick="op('1')">1</button><button onclick="op('2')">2</button><button onclick="op('3')">3</button><button onclick="op('+')">+</button>
                <button onclick="op('0')" style="grid-column:span 2;">0</button><button onclick="op('.')">.</button><button style="background:var(--s);" onclick="eq()">=</button>
            </div>
        </div>

        <!-- รวมปริมาตร -->
        <div class="tab-content" id="volume">
            <input type="number" id="v800" value="" min="0" onchange="sumVol()">
            <label>ขวด 800 มล.</label>
            <input type="number" id="v1000" value="" min="0" onchange="sumVol()">
            <label>ขวด 1,000 มล.</label>
            <input type="number" id="v1500" value="" min="0" onchange="sumVol()">
            <label>ขวด 1,500 มล.</label>
            <div class="card" style="margin-top:5px;">
                <div class="big" id="totalL">0.00</div>
                <div style="color:#94a3b8;">ลิตร</div>
                <div style="display:grid; grid-template-columns:repeat(2,1fr); gap:5px; margin-top:5px;">
                    <div class="card"><div style="font-size:1.2rem; color:var(--p);" id="c800">0</div>ขวด 800</div>
                    <div class="card"><div style="font-size:1.2rem; color:var(--p);" id="c1000">0</div>ขวด 1000</div>
                    <div class="card"><div style="font-size:1.2rem; color:var(--p);" id="c1500">0</div>ขวด 1500</div>
                    <div class="card" style="background:rgba(16,185,129,.3);"><div style="font-size:1.2rem; color:var(--s);" id="totalB">0</div>รวมทั้งหมด</div>
                </div>
            </div>
        </div>

        <!-- แบ่งขวดกระท่อม (สุดยอดเวอร์ชัน) -->
        <div class="tab-content active" id="kratom">
            <div class="kratom">
                <button class="settings-btn" id="setBtn">Settings</button>
                <h2 style="text-align:center; font-size:1rem; margin-bottom:5px;">แบ่งขวดกระท่อมอัจฉริยะ</h2>
                <p style="text-align:center; opacity:0.5;">คำนวณทันที • เหลือน้ำน้อยที่สุด</p>

                <input type="number" id="liters" step="0.1" placeholder="ป้อนน้ำกระท่อม (ลิตร)" style="margin:10px 0; font-size:1.12rem; text-align:center;">

                <div id="result" style="display:none; margin-top:5px;">
                    <h5 style="text-align:center; color:#66ff99; font-size:1rem; margin:5px 0;">ผลลัพธ์ที่ดีที่สุด</h5>
                    <div style="display:grid; grid-template-columns:repeat(auto-fit,minmax(100px,1fr)); gap:5px;">
                        <div class="card"><div class="big" id="n800">0</div>ขวด 800 มล.</div>
                        <div class="card"><div class="big" id="n1000">0</div>ขวด 1000 มล.</div>
                        <div class="card"><div class="big" id="n1500">0</div>ขวด 1500 มล.</div>
                    </div>
                    <div style="margin-top:5px; background:rgba(102,187,106,.2); padding:5px; border-radius:12px; border-left:10px solid #66bb6a;">
                        <p><strong>ใช้น้ำ:</strong> <span id="usedL">0</span>1 ลิตร</p>
                        <p><strong>เหลือ:</strong> <span id="remainL">0</span> ลิตร</p>
                        <p><strong>รวมขวด:</strong> <span id="totalBot">0</span> ขวด</p>
                        <p><strong>ประสิทธิภาพ:</strong> <span id="eff">0</span>%</p>
                    </div>
                </div>

                <!-- การตั้งค่าขั้นสูง -->
                <div class="settings" id="settings">
                    <h5 style="color:#66bb6a; margin-bottom:5px;">ตั้งค่าสัดส่วนและเปิด/ปิดขวด</h5>
                    
                    <div class="toggle">
                        <span>ใช้ขวด 800 มล.</span>
                        <label class="switch"><input type="checkbox" id="use800" checked><span class="slider"></span></label>
                    </div>
                    <input type="number" id="pct800" min="0" max="100" value="90" placeholder="เปอร์เซ็นต์ 800 มล.">

                    <div class="toggle">
                        <span>ใช้ขวด 1000 มล.</span>
                        <label class="switch"><input type="checkbox" id="use1000" checked><span class="slider"></span></label>
                    </div>
                    <input type="number" id="pct1000" min="0" max="100" value="10" placeholder="เปอร์เซ็นต์ 1000 มล.">

                    <div class="toggle">
                        <span>ใช้ขวด 1500 มล.</span>
                        <label class="switch"><input type="checkbox" id="use1500"><span class="slider"></span></label>
                    </div>
                    <input type="number" id="pct1500" min="0" max="100" value="0" placeholder="เปอร์เซ็นต์ 1500 มล.">

                    <label style="margin-top:10px; display:block;">น้ำเหลือสูงสุดที่ยอมรับ (ลิตร)</label>
                    <input type="number" id="maxWaste" value="0.4" step="0.1" min="0.1" max="3">

                    <button style="margin-top:10px; background:#f59e0b;" onclick="saveConfig()">บันทึกการตั้งค่า</button>
                </div>
            </div>
        </div>
    </div>
</div>

<button class="install" id="installBtn">ติดตั้งแอพนี้</button>

<script>
    // PWA
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', e => { e.preventDefault(); deferredPrompt = e; document.getElementById('installBtn').style.display = 'block'; });
    document.getElementById('installBtn').onclick = () => { if(deferredPrompt){deferredPrompt.prompt(); deferredPrompt=null; document.getElementById('installBtn').style.display='none';}};

    // แท็บ
    document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>{document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active')); document.querySelectorAll('.tab-content').forEach(x=>x.classList.remove('active')); t.classList.add('active'); document.getElementById(t.dataset.tab).classList.add('active');});

    // โหลดการตั้งค่า
    const cfg = JSON.parse(localStorage.getItem('kratomCfg')) || {use800:true,pct800:60,use1000:true,pct1000:35,use1500:false,pct1500:5,maxWaste:0.7};
    Object.keys(cfg).forEach(k=> { const el=document.getElementById(k); if(el) el.type==='checkbox'?el.checked=cfg[k]:el.value=cfg[k]; });

    document.getElementById('setBtn').onclick = () => document.getElementById('settings').classList.toggle('show');
    function saveConfig(){ localStorage.setItem('kratomCfg', JSON.stringify({use800:document.getElementById('use800').checked, pct800:+document.getElementById('pct800').value||0, use1000:document.getElementById('use1000').checked, pct1000:+document.getElementById('pct1000').value||0, use1500:document.getElementById('use1500').checked, pct1500:+document.getElementById('pct1500').value||0, maxWaste:+document.getElementById('maxWaste').value||0.7})); alert('บันทึกแล้ว'); }

    
 // 1. แปลงปริมาตร
    function calculateWater() {
        const a = parseFloat(document.getElementById('bottles1000').value) || 0;
        const b = parseFloat(document.getElementById('bottles800').value) || 0;
        if ((a > 0 && b > 0) || (a === 0 && b === 0)) return alert("กรอกเพียงช่องใดช่องหนึ่ง");
        let text = "", details = "";
        if (a > 0) {
            text = `${a} ขวด (1000มล.) = ${(a*1000/800).toFixed(3)} ขวด (800มล.)`;
            details = `ปริมาณรวม: ${(a*1000).toLocaleString()} มล.<br>ราคาน้ำ: ${(a*40).toLocaleString()} บาท`;
        } else {
            text = `${b} ขวด (800มล.) = ${(b*800/1000).toFixed(3)} ขวด (1000มล.)`;
            details = `ปริมาณรวม: ${(b*800).toLocaleString()} มล.`;
        }
        document.getElementById('waterText').textContent = text;
        document.getElementById('waterDetails').innerHTML = details;
        document.getElementById('waterResult').style.display = 'block';
    }


    // เครื่องคิดเลข
    let expr='0'; function op(v){expr=expr==='0'?v:expr+v; document.getElementById('display').textContent=expr;} function clr(){expr='0';document.getElementById('display').textContent=expr;} function del(){expr=expr.slice(0,-1)||'0';document.getElementById('display').textContent=expr;} function eq(){try{const r=eval(expr.replace('×','*'));document.getElementById('display').textContent=r;expr=r+'';}catch{document.getElementById('display').textContent='Error';}}

    // รวมปริมาตร
    function sumVol(){ const a=+document.getElementById('v800').value||0, b=+document.getElementById('v1000').value||0, c=+document.getElementById('v1500').value||0; const t=a*0.8+b+c*1.5; document.getElementById('totalL').textContent=t.toFixed(2); document.getElementById('c800').textContent=a; document.getElementById('c1000').textContent=b; document.getElementById('c1500').textContent=c; document.getElementById('totalB').textContent=a+b+c; } sumVol();

    // แบ่งขวดกระท่อม
    function calcKratom(){
        const liters = +document.getElementById('liters').value||0; if(!liters){document.getElementById('result').style.display='none';return;}
        const total = Math.round(liters*1000);
        const maxW = cfg.maxWaste*1000;

        const bottles = [
            cfg.use800 ? {size:800, target:total*(cfg.pct800/100)} : null,
            cfg.use1000 ? {size:1000, target:total*(cfg.pct1000/100)} : null,
            cfg.use1500 ? {size:1500, target:total*(cfg.pct1500/100)} : null
        ].filter(Boolean);

        let best=null, bestScore=-1e9;
        const max = [Math.ceil(total/1500)+5, Math.ceil(total/1000)+10, Math.ceil(total/800)+20];

        for(let n15=0; n15<=(bottles.find(b=>b.size===1500)?max[0]:0); n15++){
            for(let n10=0; n10<=(bottles.find(b=>b.size===1000)?max[1]:0); n10++){
                for(let n8=0; n8<=(bottles.find(b=>b.size===800)?max[2]:0); n8++){
                    const used = n15*1500 + n10*1000 + n8*800;
                    const remain = total - used;
                    if(Math.abs(remain)>maxW) continue;

                    let score = used/total*1000;
                    bottles.forEach(b=>{ if(b.size===800) score -= Math.abs(n8*800 - b.target)/Math.max(1,b.target)*10;
                        if(b.size===1000) score -= Math.abs(n10*1000 - b.target)/Math.max(1,b.target)*10;
                        if(b.size===1500) score -= Math.abs(n15*1500 - b.target)/Math.max(1,b.target)*10; });
                    score -= Math.abs(remain);

                    if(score>bestScore){ bestScore=score; best={n8,n10,n15,used,remain}; }
                }
            }
        }

        if(!best){ const n8=Math.floor(total/800); best={n8,n10:0,n15:0,used:n8*800,remain:total-n8*800}; }

        document.getElementById('n800').textContent=best.n8||0;
        document.getElementById('n1000').textContent=best.n10||0;
        document.getElementById('n1500').textContent=best.n15||0;
        document.getElementById('usedL').textContent=(best.used/1000).toFixed(3);
        document.getElementById('remainL').textContent=(best.remain/1000).toFixed(3);
        document.getElementById('totalBot').textContent=(best.n8||0)+(best.n10||0)+(best.n15||0);
        document.getElementById('eff').textContent=((best.used/total)*100).toFixed(2);
        document.getElementById('result').style.display='block';
    }

    document.getElementById('liters').addEventListener('input',()=>setTimeout(calcKratom,400));
</script>
</body>
</html>